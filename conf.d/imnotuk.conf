server {
        listen 443 ssl;
        listen [::]:443 ssl;
        http2 on;
        http3 on;
        quic_retry on;
        ssl_early_data on;
        quic_gso on;
        ssl_certificate /etc/nginx/ssl/fullchain.pem;
        ssl_certificate_key /etc/nginx/ssl/key.pem;
        ssl_dhparam /etc/nginx/dhparam.pem; 
        ssl_verify_client on;
        ssl_client_certificate /etc/nginx/ssl/cloudflare.crt;
        server_name imnot.uk;

        gzip on;
        gunzip on;
        gzip_static on;

        root /var/www/html/mee;
        index simula.html;

        # Cloudflare CDN Settings
        add_header CF-Cache-Status $upstream_cache_status;

        # Static assets - with Cloudflare optimization
        location ~* \.(css|js|json|xml)$ {
            expires 7d;
            add_header Cache-Control "public, must-revalidate, proxy-revalidate, max-age=604800";
            add_header CDN-Cache-Control "public, max-age=604800";
            add_header CF-Cache-Status $upstream_cache_status;
            try_files $uri =404;
        }

        # Images and videos - with Cloudflare optimization
        location ~* \.(jpg|jpeg|png|gif|ico|webp|svg|mp4|webm|mov|avi)$ {
            expires 30d;
            add_header Cache-Control "public, must-revalidate, proxy-revalidate, max-age=2592000";
            add_header CDN-Cache-Control "public, max-age=2592000";
            add_header CF-Cache-Status $upstream_cache_status;
            add_header Vary "Accept-Encoding";
            etag on;
            if_modified_since exact;
            try_files $uri =404;
        }

        # HTML and dynamic content - no caching
        location ~* \.(html|htm)$ {
            expires -1;
            add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";
            try_files $uri =404;
        }

        location / {
                try_files $uri $uri/ =404;                
        }
}